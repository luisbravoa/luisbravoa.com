/*! DashLite.js 2015-04-03 */
!function(a,b){"function"==typeof define?define(b):"object"==typeof exports?module.exports=b():a.DashLite=b()}(this,function(){function a(a){this.options=a,this.element=h.parse('<div class="DashLite-item white"><div class="DashLite-item-holder"><div class="DashLite-item-header"><div class="DashLite-item-header-text"></div><div class="DashLite-item-header-icons"><a href="#" class="DashLite-item-header-action-colapse"><icon class="DashLite-item-header-icon arrowUp"></icon><icon class="DashLite-item-header-icon arrowDown"><icon></a></div></div><div class="DashLite-item-content"><div class="DashLite-item-content-holder"></div></div></div></div>'),this.headerElement=this.element.querySelector(".DashLite-item-header"),this.contentElement=this.element.querySelector(".DashLite-item-content"),this.contentHolderElement=this.element.querySelector(".DashLite-item-content-holder"),this.contentHolderElement.innerHTML=this.options.content,this.options.title&&(this.headerElement.querySelector(".DashLite-item-header-text").innerHTML=this.options.title),this.color(),this.listenForDragAndDropEvents(),this.collapseButton=this.element.querySelector(".DashLite-item-header-action-colapse"),this.collapsed=!1,requestAnimationFrame(function(){this.maxHeight=this.contentElement.offsetHeight+"px",this.contentElement.style.maxHeight=this.maxHeight}.bind(this)),this.collapseButton.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation(),this.collapsed=!this.collapsed,this.collapsed?(this.contentElement.style.maxHeight="0px",h.addClass(this.element,"collapsed")):(this.contentElement.style.maxHeight=this.maxHeight,h.removeClass(this.element,"collapsed"))}.bind(this))}function b(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function c(a){this.options=a,this.element=h.parse('<div class="DashLite-column"></div>'),this.createItems()}function d(a){return a=void 0===a?100:a,h.parse('<div class="DashLite-item-placeholder" style="height:'+a+'px;"><div class="DashLite-item-placeholder-holder"></div></div>')}function e(a){"use strict";this.options=a,this.element=h.parse('<div class="DashLite"></div>'),this.createColumns(),this.setLayout(this.options.items.length),this.options.parentElement.appendChild(this.element)}function f(a){var b,c,d;return this.columns.forEach(function(e){e.element.contains(a)&&(b=e,b.items.forEach(function(b){(b.element.contains(a)||b.element===a)&&(c=b)}.bind(this)),void 0===e.destinationPlaceHolder||e.destinationPlaceHolder!==a&&!e.destinationPlaceHolder.contains(a)||(d=e.destinationPlaceHolder))}.bind(this)),{column:b,item:c,destinationPlaceholder:d}}function g(a){var b,c,d;return this.columns.forEach(function(e){d=e.getItemByElement(a),d&&(b=e,c=d)}.bind(this)),{column:b,item:c}}var h={parse:function(a){var b=document.createElement("div");return b.innerHTML=a,b.firstChild},addClass:function(a,b){var c=a.className;-1===c.indexOf(b)&&(a.className+=" "+b)},removeClass:function(a,b){var c=a.className;-1!==c.indexOf(b)&&(a.className=c.replace(b,"").trim())}};return a.prototype.color=function(){var a=["#ec663c","#9c4274","#12b0c5","#ff9618","#979996"];this.element.style.backgroundColor=a[b(0,a.length-1)]},a.prototype.onMove=function(a){if(a.stopPropagation(),a.preventDefault(),1!==a.which)return this.revertDrag(),void this.element.dispatchEvent(new Event("drag:cancel"));var b={x:a.clientX+document.body.scrollLeft-document.documentElement.offsetLeft,y:a.clientY+document.body.scrollTop-document.documentElement.offsetTop};this.element.style.left=b.x-this.offsetX+document.body.scrollLeft+"px",this.element.style.top=b.y-this.offsetY+document.body.scrollTop+"px",this.element.style.display="none",this.destinationElement=document.elementFromPoint(a.clientX,a.clientY),this.element.style.display="";var c=new Event("drag:move");c.destinationElement=this.destinationElement,this.element.dispatchEvent(c)},a.prototype.revertDrag=function(){h.removeClass(this.element,"drag"),this.element.style.left="",this.element.style.top="",this.element.style.width="",document.body.removeEventListener("mousemove",this.onMoveHandler,!0)},a.prototype.onDrag=function(a){a.stopPropagation(),a.preventDefault();var b={x:a.clientX+document.body.scrollLeft-document.body.clientLeft,y:a.clientY+document.body.scrollTop-document.body.clientTop},c=this.element.getBoundingClientRect();this.offsetX=b.x-c.left,this.offsetY=b.y-c.top,this.element.style.width=c.width+"px",h.addClass(this.element,"drag"),this.onMoveHandler=this.onMove.bind(this),document.body.addEventListener("mousemove",this.onMoveHandler,!0);var d=new Event("drag:start");this.element.dispatchEvent(d)},a.prototype.onDrop=function(a){a.stopPropagation(),a.preventDefault(),this.revertDrag();var b=new Event("drag:stop");b.destinationElement=this.destinationElement,this.element.dispatchEvent(b),this.destinationElement=void 0},a.prototype.listenForDragAndDropEvents=function(){this.mouseDownEvent=this.headerElement.querySelector(".DashLite-item-header-text").addEventListener("mousedown",this.onDrag.bind(this),!0),this.mouseUpEvent=this.element.addEventListener("mouseup",this.onDrop.bind(this),!0)},c.prototype.createItems=function(){this.items=[],this.options.items.forEach(function(b){var c=new a(b);this.items.push(c),this.element.appendChild(c.element)}.bind(this))},c.prototype.getItemByElement=function(a){var b;return this.items.forEach(function(c){c.element==a&&(b=c)}.bind(this)),b},c.prototype.addOriginPlaceHolder=function(a){this.originPlaceHolder=d(a.element.offsetHeight),this.element.insertBefore(this.originPlaceHolder,a.element)},c.prototype.addDestinationPlaceHolder=function(a,b){if(a!==b){var c=this.items.indexOf(a);-1!==c?(this.destinationPlaceHolder=d(b.element.offsetHeight),this.element.insertBefore(this.destinationPlaceHolder,a.element)):(this.destinationPlaceHolder=d(b.element.offsetHeight),this.element.appendChild(this.destinationPlaceHolder))}},c.prototype.removeOriginPlaceHolder=function(){this.originPlaceHolder&&(this.element.removeChild(this.originPlaceHolder),delete this.originPlaceHolder)},c.prototype.removeDestinationPlaceHolder=function(){this.destinationPlaceHolder&&(this.element.removeChild(this.destinationPlaceHolder),delete this.destinationPlaceHolder)},c.prototype.extractItem=function(a){return void 0!==this.items[a]?(this.element.removeChild(this.items[a].element),this.items.splice(a,1)[0]):void 0},c.prototype.addItemInPlaceholder=function(a){if(void 0!==this.destinationPlaceHolder){{Array.prototype.indexOf.call(this.element.childNodes,this.destinationPlaceHolder)}this.element.replaceChild(a.element,this.destinationPlaceHolder),delete this.destinationPlaceHolder,console.log(this.items.length),this.items.splice(1,0,a),console.log(this.items.length)}},e.prototype.createColumns=function(){this.columns=[],this.options.items.forEach(function(a){var b=new c({items:a});this.columns.push(b),this.element.appendChild(b.element),b.items.forEach(function(a){a.element.addEventListener("drag:start",this.onDragStart.bind(this)),a.element.addEventListener("drag:stop",this.onDragStop.bind(this)),a.element.addEventListener("drag:move",this.onDragMove.bind(this)),a.element.addEventListener("drag:cancel",this.onDragCancel.bind(this))}.bind(this))}.bind(this))},e.prototype.onDragMove=function(a){var b=a.destinationElement,c=g.call(this,a.target),d=f.call(this,a.destinationElement),e=void 0!==d.item&&c.item.element.nextSibling===d.item.element,h=void 0!==c.column&&c.column.originPlaceHolder&&(c.column.originPlaceHolder===b||c.column.originPlaceHolder.contains(b)),i=void 0===d.column&&void 0===d.item&&void 0===d.destinationPlaceholder,j=void 0!==d.column&&void 0!==d.item&&void 0===d.destinationPlaceholder,k=void 0!==d.column&&void 0===d.destinationPlaceholder&&c.column.originPlaceHolder!==d.destinationPlaceholder;h||e||i?this.removeDestinationPlaceholders():(j||k)&&(this.removeDestinationPlaceholders(),d.column.addDestinationPlaceHolder(d.item,c.item),this.destinationColumn=d.column)},e.prototype.removeDestinationPlaceholders=function(){this.columns.forEach(function(a){a.removeDestinationPlaceHolder()})},e.prototype.onDragStart=function(a){console.log(a);var b=g.call(this,a.target);b.column.addOriginPlaceHolder(b.item)},e.prototype.onDragStop=function(a){var b=g.call(this,a.target);if(void 0!==b.column&&void 0!==b.item&&void 0!==this.destinationColumn){var c=b.column.items.indexOf(b.item);b.column.extractItem(c),this.destinationColumn.addItemInPlaceholder(b.item),delete this.destinationColumn}b.column.removeOriginPlaceHolder()},e.prototype.onDragCancel=function(a){var b=g.call(this,a.target);b.column.removeOriginPlaceHolder(),this.removeDestinationPlaceholders()},e.prototype.setLayout=function(a){var b="fourColumn";switch(a){case 1:b="oneColumn";break;case 2:b="twoColumn";break;case 3:b="threeColumn";break;case 4:b="fourColumn";break;default:b="fourColumn"}this.element.className+=" "+b},e});